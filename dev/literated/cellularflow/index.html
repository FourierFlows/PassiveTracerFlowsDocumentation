<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Advection-diffusion of tracer by cellular flow · PassiveTracerFlows.jl</title><meta name="title" content="Advection-diffusion of tracer by cellular flow · PassiveTracerFlows.jl"/><meta property="og:title" content="Advection-diffusion of tracer by cellular flow · PassiveTracerFlows.jl"/><meta property="twitter:title" content="Advection-diffusion of tracer by cellular flow · PassiveTracerFlows.jl"/><meta name="description" content="Documentation for PassiveTracerFlows.jl."/><meta property="og:description" content="Documentation for PassiveTracerFlows.jl."/><meta property="twitter:description" content="Documentation for PassiveTracerFlows.jl."/><meta property="og:url" content="https://fourierflows.github.io/PassiveTracerFlowsDocumentation/stable/literated/cellularflow/"/><meta property="twitter:url" content="https://fourierflows.github.io/PassiveTracerFlowsDocumentation/stable/literated/cellularflow/"/><link rel="canonical" href="https://fourierflows.github.io/PassiveTracerFlowsDocumentation/stable/literated/cellularflow/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">PassiveTracerFlows.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Examples</span><ul><li><input class="collapse-toggle" id="menuitem-2-1" type="checkbox" checked/><label class="tocitem" for="menuitem-2-1"><span class="docs-label">TracerAdvectionDiffusion</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../onedim_gaussiandiffusion/">Advection-diffusion of tracer in one dimension</a></li><li class="is-active"><a class="tocitem" href>Advection-diffusion of tracer by cellular flow</a><ul class="internal"><li><a class="tocitem" href="#Install-dependencies"><span>Install dependencies</span></a></li><li><a class="tocitem" href="#Let&#39;s-begin"><span>Let&#39;s begin</span></a></li><li><a class="tocitem" href="#Choosing-a-device:-CPU-or-GPU"><span>Choosing a device: CPU or GPU</span></a></li><li><a class="tocitem" href="#Numerical-parameters-and-time-stepping-parameters"><span>Numerical parameters and time-stepping parameters</span></a></li><li><a class="tocitem" href="#Numerical-parameters-and-time-stepping-parameters-2"><span>Numerical parameters and time-stepping parameters</span></a></li><li><a class="tocitem" href="#Set-up-cellular-flow"><span>Set up cellular flow</span></a></li><li><a class="tocitem" href="#Problem-setup"><span>Problem setup</span></a></li><li><a class="tocitem" href="#Setting-initial-conditions"><span>Setting initial conditions</span></a></li><li><a class="tocitem" href="#Time-stepping-the-Problem-forward"><span>Time-stepping the <code>Problem</code> forward</span></a></li></ul></li><li><a class="tocitem" href="../turbulent_advection-diffusion/">Advection-diffusion of tracer by a turbulent flow</a></li></ul></li></ul></li><li><span class="tocitem">Modules</span><ul><li><a class="tocitem" href="../../modules/traceradvectiondiffusion/">TracerAdvectionDiffusion Module</a></li></ul></li><li><span class="tocitem">DocStrings</span><ul><li><a class="tocitem" href="../../man/types/">Private types</a></li><li><a class="tocitem" href="../../man/functions/">Functions</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li><a class="is-disabled">TracerAdvectionDiffusion</a></li><li class="is-active"><a href>Advection-diffusion of tracer by cellular flow</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Advection-diffusion of tracer by cellular flow</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/FourierFlows/PassiveTracerFlows.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/FourierFlows/PassiveTracerFlows.jl/blob/main/examples/cellularflow.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Advection-diffusion-of-tracer-by-cellular-flow"><a class="docs-heading-anchor" href="#Advection-diffusion-of-tracer-by-cellular-flow">Advection-diffusion of tracer by cellular flow</a><a id="Advection-diffusion-of-tracer-by-cellular-flow-1"></a><a class="docs-heading-anchor-permalink" href="#Advection-diffusion-of-tracer-by-cellular-flow" title="Permalink"></a></h1><p>This example can be viewed as a Jupyter notebook via <a href="https://nbviewer.jupyter.org/github/FourierFlows/PassiveTracerFlowsDocumentation/blob/gh-pages/dev/literated/cellularflow.ipynb"><img src="https://img.shields.io/badge/show-nbviewer-579ACA.svg" alt/></a>.</p><p>An example demonstrating the advection-diffusion of a tracer by a cellular flow.</p><h2 id="Install-dependencies"><a class="docs-heading-anchor" href="#Install-dependencies">Install dependencies</a><a id="Install-dependencies-1"></a><a class="docs-heading-anchor-permalink" href="#Install-dependencies" title="Permalink"></a></h2><p>First let&#39;s make sure we have all required packages installed.</p><pre><code class="language-julia hljs">using Pkg
pkg&quot;add PassiveTracerFlows, CairoMakie, Printf&quot;</code></pre><h2 id="Let&#39;s-begin"><a class="docs-heading-anchor" href="#Let&#39;s-begin">Let&#39;s begin</a><a id="Let&#39;s-begin-1"></a><a class="docs-heading-anchor-permalink" href="#Let&#39;s-begin" title="Permalink"></a></h2><p>Let&#39;s load <code>PassiveTracerFlows.jl</code> and some other needed packages.</p><pre><code class="language-julia hljs">using PassiveTracerFlows, CairoMakie, Printf</code></pre><h2 id="Choosing-a-device:-CPU-or-GPU"><a class="docs-heading-anchor" href="#Choosing-a-device:-CPU-or-GPU">Choosing a device: CPU or GPU</a><a id="Choosing-a-device:-CPU-or-GPU-1"></a><a class="docs-heading-anchor-permalink" href="#Choosing-a-device:-CPU-or-GPU" title="Permalink"></a></h2><pre><code class="language-julia hljs">dev = CPU()     # Device (CPU/GPU)</code></pre><h2 id="Numerical-parameters-and-time-stepping-parameters"><a class="docs-heading-anchor" href="#Numerical-parameters-and-time-stepping-parameters">Numerical parameters and time-stepping parameters</a><a id="Numerical-parameters-and-time-stepping-parameters-1"></a><a class="docs-heading-anchor-permalink" href="#Numerical-parameters-and-time-stepping-parameters" title="Permalink"></a></h2><pre><code class="language-julia hljs">     nx = 128            # 2D resolution = nx²
stepper = &quot;RK4&quot;          # timestepper
     dt = 0.02           # timestep
 nsteps = 800            # total number of time-steps
 nsubs  = 25             # number of time-steps for intermediate logging/plotting (nsteps must be multiple of nsubs)</code></pre><h2 id="Numerical-parameters-and-time-stepping-parameters-2"><a class="docs-heading-anchor" href="#Numerical-parameters-and-time-stepping-parameters-2">Numerical parameters and time-stepping parameters</a><a class="docs-heading-anchor-permalink" href="#Numerical-parameters-and-time-stepping-parameters-2" title="Permalink"></a></h2><pre><code class="language-julia hljs">Lx = 2π       # domain size
κ = 0.002     # diffusivity</code></pre><h2 id="Set-up-cellular-flow"><a class="docs-heading-anchor" href="#Set-up-cellular-flow">Set up cellular flow</a><a id="Set-up-cellular-flow-1"></a><a class="docs-heading-anchor-permalink" href="#Set-up-cellular-flow" title="Permalink"></a></h2><p>We create a two-dimensional grid to construct the cellular flow. Our cellular flow is derived from a streamfunction <span>$ψ(x, y) = ψ₀ \cos(x) \cos(y)$</span> as <span>$(u, v) = (-∂_y ψ, ∂_x ψ)$</span>. The cellular flow is then passed into the <code>TwoDAdvectingFlow</code> constructor with <code>steadyflow = true</code> to indicate that the flow is not time dependent.</p><pre><code class="language-julia hljs">grid = TwoDGrid(dev; nx, Lx)

ψ₀ = 0.2
mx, my = 1, 1

ψ = [ψ₀ * cos(mx * grid.x[i]) * cos(my * grid.y[j]) for i in 1:grid.nx, j in 1:grid.ny]

uvel(x, y) =  ψ₀ * my * cos(mx * x) * sin(my * y)
vvel(x, y) = -ψ₀ * mx * sin(mx * x) * cos(my * y)
advecting_flow = TwoDAdvectingFlow(; u = uvel, v = vvel, steadyflow = true)</code></pre><h2 id="Problem-setup"><a class="docs-heading-anchor" href="#Problem-setup">Problem setup</a><a id="Problem-setup-1"></a><a class="docs-heading-anchor-permalink" href="#Problem-setup" title="Permalink"></a></h2><p>We initialize a <code>Problem</code> by providing a set of keyword arguments.</p><pre><code class="language-julia hljs">prob = TracerAdvectionDiffusion.Problem(dev, advecting_flow; nx, Lx, κ, dt, stepper)</code></pre><p>and define some shortcuts</p><pre><code class="language-julia hljs">sol, clock, vars, params, grid = prob.sol, prob.clock, prob.vars, prob.params, prob.grid
x, y = grid.x, grid.y</code></pre><h2 id="Setting-initial-conditions"><a class="docs-heading-anchor" href="#Setting-initial-conditions">Setting initial conditions</a><a id="Setting-initial-conditions-1"></a><a class="docs-heading-anchor-permalink" href="#Setting-initial-conditions" title="Permalink"></a></h2><p>Our initial condition for the tracer <span>$c$</span> is a gaussian centered at <span>$(x, y) = (L_x/5, 0)$</span>.</p><pre><code class="language-julia hljs">gaussian(x, y, σ) = exp(-(x^2 + y^2) / (2σ^2))

amplitude, spread = 0.5, 0.15
c₀ = [amplitude * gaussian(x[i] - 0.2 * grid.Lx, y[j], spread) for i=1:grid.nx, j=1:grid.ny]

TracerAdvectionDiffusion.set_c!(prob, c₀)</code></pre><h2 id="Time-stepping-the-Problem-forward"><a class="docs-heading-anchor" href="#Time-stepping-the-Problem-forward">Time-stepping the <code>Problem</code> forward</a><a id="Time-stepping-the-Problem-forward-1"></a><a class="docs-heading-anchor-permalink" href="#Time-stepping-the-Problem-forward" title="Permalink"></a></h2><p>We want to step the <code>Problem</code> forward in time and, whilst doing so, we&#39;d like to produce an animation of the tracer concentration.</p><p>First we create a figure using <a href="https://makie.juliaplots.org/stable/documentation/nodes/"><code>Observable</code></a>s.</p><pre><code class="language-julia hljs">c_anim = Observable(Array(vars.c))
title = Observable(@sprintf(&quot;concentration, t = %.2f&quot;, clock.t))

Lx, Ly = grid.Lx, grid.Ly

fig = Figure(size = (600, 600))

ax = Axis(fig[1, 1],
          xlabel = &quot;x&quot;,
          ylabel = &quot;y&quot;,
          aspect = 1,
          title = title,
          limits = ((-Lx/2, Lx/2), (-Ly/2, Ly/2)))

hm = heatmap!(ax, x, y, c_anim;
              colormap = :balance, colorrange = (-0.2, 0.2))

contour!(ax, x, y, ψ;
         levels =  0.0125:0.025:0.2, color = :grey, linestyle = :solid)
contour!(ax, x, y, ψ;
         levels = -0.1875:0.025:-0.0125, color = (:grey, 0.8), linestyle = :dash)

fig</code></pre><img src="3cc94902.png" alt="Example block output"/><p>Now we time-step <code>Problem</code> and update the <code>c_anim</code> and <code>title</code> observables as we go to create an animation.</p><pre><code class="language-julia hljs">startwalltime = time()

frames = 0:round(Int, nsteps/nsubs)
record(fig, &quot;cellularflow_advection-diffusion.mp4&quot;, frames, framerate = 12) do j
   if j % (200 / nsubs) == 0
      log = @sprintf(&quot;step: %04d, t: %d, walltime: %.2f min&quot;,
                     clock.step, clock.t, (time()-startwalltime)/60)

      println(log)
    end

  c_anim[] = vars.c
  title[] = @sprintf(&quot;concentration, t = %.2f&quot;, clock.t)

  stepforward!(prob, nsubs)
  TracerAdvectionDiffusion.updatevars!(prob)
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">&quot;cellularflow_advection-diffusion.mp4&quot;</code></pre><p><video src="../cellularflow_advection-diffusion.mp4" controls="true" title><a href="../cellularflow_advection-diffusion.mp4"></a></video></p><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../onedim_gaussiandiffusion/">« Advection-diffusion of tracer in one dimension</a><a class="docs-footer-nextpage" href="../turbulent_advection-diffusion/">Advection-diffusion of tracer by a turbulent flow »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.2.1 on <span class="colophon-date" title="Friday 26 January 2024 06:46">Friday 26 January 2024</span>. Using Julia version 1.10.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
